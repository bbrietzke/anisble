---
- name: Consul Servers
  hosts: consul_servers
  become: yes
  roles:
    - consul
  vars:
    consul_server: true
    consul_ui: true
    consul_datacenter: basement

- name: Consul Agents
  hosts: consul_agents
  become: yes
  roles:
    - consul
  vars:
    consul_datacenter: basement

- name: Install Vault Servers
  hosts: vault_servers
  become: yes
  roles:
    - vault
  vars:
    vault_use_consul: true
    vault_use_http: true

- name: Node Exporters
  hosts: all
  become: yes
  roles:
    - node_exporter
  

- name: PostgreSQL Servers
  hosts: postgresql_servers
  become: yes
  roles:
    - postgresql
  
- name: Install NFS Servers
  hosts: nfs_servers
  become: yes
  roles:
    - nfs_server
  vars:
    subnet: "192.168.1.0/24"
    share_path: "/srv/nfs_shares"
    nfs_shares:
      - { share_name: prometheus }
      - { share_name: prom_alertman }
      - { share_name: kubernetes_clients }
      - { share_name: mastodon }
      - { share_name: share_stls }

- name: Peripheral Servers
  hosts: peripheral_server
  become: yes
  roles:
    - redis
    - mqtt